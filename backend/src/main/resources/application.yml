server:
  port: 8080
  servlet:
    context-path: /api

spring:
  application:
    name: post-agent
  
  # MySQL数据库配置
  datasource:
    url: jdbc:mysql://localhost:3306/review_agent?useUnicode=true&characterEncoding=utf8&useSSL=false&serverTimezone=Asia/Shanghai&allowPublicKeyRetrieval=true
    driver-class-name: com.mysql.cj.jdbc.Driver
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}

    min-idle: 10 # 最小连接池数量
    maxActive: 50 # 最大连接池数量
    maxWait: 30000 # 获取连接时最大等待时间，单位毫秒。配置了maxWait之后，缺省启用公平锁，并发效率会有所下降，如果需要可以通过配置
    timeBetweenEvictionRunsMillis: 60000 # 关闭空闲连接的检测时间间隔.Destroy线程会检测连接的间隔时间，如果连接空闲时间大于等于minEvictableIdleTimeMillis则关闭物理连接。
    minEvictableIdleTimeMillis: 300000 # 连接的最小生存时间.连接保持空闲而不被驱逐的最小时间
    testWhileIdle: true # 申请连接时检测空闲时间，根据空闲时间再检测连接是否有效.建议配置为true，不影响性能，并且保证安全性。申请连接的时候检测，如果空闲时间大于timeBetweenEvictionRun
    poolPreparedStatements: true # 开启PSCache
    maxPoolPreparedStatementPerConnectionSize: 20 #设置PSCache值
    connectionErrorRetryAttempts: 3 # 连接出错后再尝试连接次数
    breakAfterAcquireFailure: true # 数据库服务宕机自动重连机制
    timeBetweenConnectErrorMillis: 3000 # 连接出错后重试时间间隔

  jpa:
    show-sql: false
    hibernate:
      dialect: org.hibernate.dialect.MySQL8Dialect
  
  # Spring AI Alibaba配置
  ai:
    dashscope:
      # 替换为你自己的 DashScope API Key
      api-key: ${DASHSCOPE_API_KEY}
      chat:
        model: qwen-plus
      embedding:
        model: text-embedding-v3
    ollama:
      base-url: ${OLLAMA_BASE_URL:http://127.0.0.1:11434}
      chat:
        model: ${OLLAMA_CHAT_MODEL:qwen2.5:14b}
      embedding:
        model: bge-m3:latest

# 日志配置
logging:
  level:
    com.review.agent: INFO
    com.alibaba.cloud.ai: INFO
    org.springframework.web: INFO
#  pattern:
#    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n"

# 管理端点配置
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus
  endpoint:
    health:
      show-details: always
